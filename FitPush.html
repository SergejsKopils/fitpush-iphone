<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="FitPush" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no" />
<meta name="theme-color" content="#06090f" />
<link rel="manifest" href="manifest.webmanifest" />
<title>FitPush</title>
<style>
:root{--bg:#05070c;--glass:rgba(255,255,255,.06);--line:rgba(255,255,255,.16);--text:#f5f7fb;--muted:#9aa6bb;--accent:#7dd3fc;--accent2:#22d3ee;--ok:#86efac;--warn:#fdba74;--danger:#fca5a5}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;color:var(--text);font-family:"Segoe UI",Tahoma,sans-serif;background:radial-gradient(circle at 50% -10%,#132238 0%,transparent 45%),radial-gradient(circle at 12% 90%,#112030 0%,transparent 40%),#05070c;overflow:hidden}
body::before{content:"";position:fixed;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.02),transparent 40%),radial-gradient(circle at 30% 30%,rgba(125,211,252,.05),transparent 55%);pointer-events:none}
.app{height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:14px;padding:calc(16px + env(safe-area-inset-top)) 16px calc(16px + env(safe-area-inset-bottom));max-width:980px;margin:0 auto}
.top{display:flex;justify-content:space-between;align-items:center;gap:10px}
.brand{font-size:.95rem;letter-spacing:.16em;text-transform:uppercase;color:#dbe6ff}
.status{font-size:.72rem;color:var(--muted);border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:rgba(255,255,255,.03)}
.stage{display:flex;align-items:center;justify-content:center}
.dial-wrap{position:relative;width:min(76vw,560px);aspect-ratio:1/1;display:grid;place-items:center}
.dial-glow{position:absolute;inset:7%;border-radius:50%;filter:blur(24px);background:radial-gradient(circle,#22d3ee33 0%,transparent 70%)}
.dial{position:relative;width:100%;height:100%;border-radius:50%;border:1px solid var(--line);background:linear-gradient(160deg,rgba(255,255,255,.1),rgba(255,255,255,.03) 45%,rgba(0,0,0,.18));backdrop-filter:blur(14px) saturate(120%);box-shadow:inset 0 0 0 1px rgba(255,255,255,.04),0 40px 80px rgba(0,0,0,.45)}
.ring{position:absolute;inset:6%;transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:rgba(255,255,255,.09);stroke-width:8}
.ring-fg{fill:none;stroke:url(#rg);stroke-width:8;stroke-linecap:round;filter:drop-shadow(0 0 10px rgba(34,211,238,.45));transition:stroke-dashoffset .25s linear}
.tick{position:absolute;inset:9%;border-radius:50%;background:repeating-conic-gradient(from 0deg,rgba(255,255,255,.16) 0deg 1deg,transparent 1deg 6deg);mask:radial-gradient(circle,transparent 73%,#000 74%)}
.core{position:absolute;inset:19%;border-radius:50%;border:1px solid rgba(255,255,255,.15);background:radial-gradient(circle at 40% 20%,rgba(255,255,255,.18),rgba(255,255,255,.03) 45%,rgba(0,0,0,.2));display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:14px}
.phase{font-size:.76rem;letter-spacing:.14em;text-transform:uppercase;color:var(--muted)}
.time{margin:8px 0 6px;font-size:clamp(2.4rem,10vw,5.4rem);line-height:1;font-variant-numeric:tabular-nums;letter-spacing:.04em}
.next{font-size:.78rem;color:#c7d6ea;min-height:18px}
.bottom{display:grid;gap:10px}
.controls,.presets,.meta{display:flex;justify-content:center;gap:8px;flex-wrap:wrap}
button{font:inherit;border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;backdrop-filter:blur(8px)}
button:active{transform:translateY(1px)}
.btn-main{background:linear-gradient(135deg,rgba(34,211,238,.32),rgba(125,211,252,.2));border-color:rgba(125,211,252,.45)}
.presets button{font-size:.86rem;padding:8px 11px;color:#d8e5f7}
.presets button.active{background:rgba(34,211,238,.24);border-color:rgba(34,211,238,.58)}
.meta{color:var(--muted);font-size:.78rem}
.dot{opacity:.35}
.chip{border:1px solid var(--line);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.04)}
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:16px;background:rgba(2,6,14,.72);backdrop-filter:blur(8px)}
.overlay.show{display:flex}
.modal{width:min(460px,100%);border:1px solid var(--line);border-radius:18px;background:linear-gradient(165deg,rgba(255,255,255,.14),rgba(255,255,255,.05));backdrop-filter:blur(12px);padding:16px}
.modal h2{margin:0 0 8px;font-size:1.25rem}
.modal p{margin:4px 0;color:#d8e5f7}
.modal .hint{font-size:.9rem;color:var(--muted)}
.modal-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);padding:10px 12px;border-radius:999px;border:1px solid #2e455d;background:rgba(8,16,28,.86);color:#d8e5f7;font-size:.82rem;display:none}
.toast.show{display:block}
@media (max-width:640px){.app{padding:calc(12px + env(safe-area-inset-top)) 10px calc(12px + env(safe-area-inset-bottom))}.dial-wrap{width:min(92vw,430px)}.core{inset:20%}.time{font-size:clamp(2.2rem,14vw,4.2rem)}}
</style>
</head>
<body>
<div class="app">
  <div class="top">
    <div class="brand">FitPush</div>
    <div id="status" class="status">Ожидание</div>
  </div>

  <div class="stage">
    <div class="dial-wrap">
      <div class="dial-glow"></div>
      <div class="dial">
        <svg class="ring" viewBox="0 0 200 200" aria-hidden="true">
          <defs>
            <linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#7dd3fc"></stop>
              <stop offset="100%" stop-color="#22d3ee"></stop>
            </linearGradient>
          </defs>
          <circle class="ring-bg" cx="100" cy="100" r="88"></circle>
          <circle id="ringFg" class="ring-fg" cx="100" cy="100" r="88"></circle>
        </svg>
        <div class="tick"></div>
        <div class="core">
          <div id="phase" class="phase">До разминки</div>
          <div id="time" class="time">60:00</div>
          <div id="next" class="next">Выбери интервал и нажми Старт</div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom">
    <div class="controls">
      <button id="start" class="btn-main">Старт</button>
      <button id="pause">Пауза</button>
      <button id="reset">Сброс</button>
      <button id="now">Сейчас</button>
      <button id="notif">Уведомления</button>
    </div>
    <div id="presets" class="presets">
      <button data-min="25">25м</button>
      <button data-min="45">45м</button>
      <button data-min="60" class="active">60м</button>
      <button data-min="90">90м</button>
    </div>
    <div class="meta">
      <span class="chip">Сегодня: <b id="stToday">0</b></span>
      <span class="chip">Стрик: <b id="stStreak">0</b></span>
      <span class="chip">Отжиманий: <b id="stPush">0</b></span>
    </div>
  </div>
</div>

<div id="overlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="mTitle">Время размяться</h2>
    <p id="mDose"></p>
    <p id="mHint" class="hint"></p>
    <div class="modal-actions">
      <button id="done" class="btn-main">Сделано</button>
      <button id="snooze">Отложить 5 мин</button>
      <button id="skip">Пропустить</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const KEY="fitpush_glass_v1";
const IS_IOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
const IS_STANDALONE=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===true;

const EX=[
  {n:"Отжимания",d:"10 повторов",h:"Ровный корпус, полная амплитуда.",p:10,m:1},
  {n:"Приседания",d:"15 повторов",h:"Пятки прижаты, колени по линии стоп.",m:1},
  {n:"Планка",d:"30 секунд",h:"Не прогибай поясницу.",m:1},
  {n:"Растяжка плеч",d:"45 секунд",h:"Плавно, без рывков.",m:1},
  {n:"Прогулка",d:"2 минуты",h:"Встань и пройдись по комнате.",m:2},
  {n:"Выпады",d:"8 на каждую сторону",h:"Контроль баланса и шага.",m:1}
];

const S={min:60,total:3600,left:3600,run:false,end:null,id:null,cur:null,stats:{today:0,push:0,streak:0,last:""}};
const E={status:g("status"),phase:g("phase"),time:g("time"),next:g("next"),ring:g("ringFg"),start:g("start"),pause:g("pause"),reset:g("reset"),now:g("now"),notif:g("notif"),presets:g("presets"),stToday:g("stToday"),stPush:g("stPush"),stStreak:g("stStreak"),overlay:g("overlay"),mTitle:g("mTitle"),mDose:g("mDose"),mHint:g("mHint"),done:g("done"),snooze:g("snooze"),skip:g("skip"),toast:g("toast")};
function g(id){return document.getElementById(id)}

const CIRC=2*Math.PI*88;
E.ring.setAttribute("stroke-dasharray",String(CIRC));

function fmt(s){const m=Math.floor(s/60),x=s%60;return String(m).padStart(2,"0")+":"+String(x).padStart(2,"0")}
function day(d=new Date()){return d.toISOString().slice(0,10)}
function save(){localStorage.setItem(KEY,JSON.stringify(S.stats))}
function load(){try{const x=localStorage.getItem(KEY);if(x)S.stats={...S.stats,...JSON.parse(x)}}catch(_){} const t=day();if(S.stats.last&&S.stats.last!==t){const y=new Date();y.setDate(y.getDate()-1);S.stats.streak=S.stats.last===day(y)?S.stats.streak+1:0;S.stats.today=0;S.stats.push=0;}S.stats.last=t;save()}

function render(){
  E.time.textContent=fmt(S.left);
  const r=Math.max(0,Math.min(1,1-S.left/S.total));
  E.ring.style.strokeDashoffset=String(CIRC*(1-r));
  if(S.run){E.status.textContent="В работе";E.status.className="status";}
  else if(S.left!==S.total){E.status.textContent="Пауза";E.status.className="status";}
  else {E.status.textContent="Ожидание";E.status.className="status";}
  E.time.style.color=S.left<=60?"var(--danger)":S.left<=300?"var(--warn)":"var(--text)";
  E.stToday.textContent=String(S.stats.today||0);
  E.stPush.textContent=String(S.stats.push||0);
  E.stStreak.textContent=String(S.stats.streak||0);
  document.title=(S.run?fmt(S.left)+" - ":"")+"FitPush";
}

function pick(min){
  S.min=min;S.total=min*60;S.left=S.total;S.end=null;
  if(S.id){clearInterval(S.id);S.id=null}
  S.run=false;
  Array.from(E.presets.querySelectorAll("button")).forEach(b=>b.classList.toggle("active",Number(b.dataset.min)===min));
  E.phase.textContent="До разминки";
  E.next.textContent="Интервал: "+min+" минут";
  render();
}

function start(){
  if(S.run)return;
  S.run=true;
  S.end=Date.now()+S.left*1000;
  E.phase.textContent="До разминки";
  S.id=setInterval(()=>{
    S.left=Math.max(0,Math.round((S.end-Date.now())/1000));
    render();
    if(S.left<=0){clearInterval(S.id);S.id=null;S.run=false;fire("timer")}
  },250);
  render();
}

function pause(){if(!S.run)return;S.run=false;if(S.id){clearInterval(S.id);S.id=null}render()}
function reset(){pause();S.left=S.total;E.phase.textContent="До разминки";E.next.textContent="Интервал: "+S.min+" минут";render()}
function toast(t){E.toast.textContent=t;E.toast.classList.add("show");setTimeout(()=>E.toast.classList.remove("show"),2600)}

function fire(src){
  S.cur=EX[Math.floor(Math.random()*EX.length)];
  E.mTitle.textContent=S.cur.n;
  E.mDose.textContent="Цель: "+S.cur.d;
  E.mHint.textContent=S.cur.h;
  E.next.textContent="Сейчас: "+S.cur.n;
  E.phase.textContent="Разминка";
  E.overlay.classList.add("show");
  sound();vib();notify(S.cur.n+" - "+S.cur.d);
}

function done(){
  if(!S.cur)return;
  S.stats.today+=1;
  if(S.cur.p)S.stats.push+=(S.cur.p||0);
  S.stats.last=day();
  save();
  S.cur=null;
  E.overlay.classList.remove("show");
  reset();start();
}

function skip(){S.cur=null;E.overlay.classList.remove("show");reset();start()}
function snooze(){S.cur=null;E.overlay.classList.remove("show");S.left=300;S.total=Math.max(S.total,300);E.phase.textContent="Отложено";E.next.textContent="Напоминание через 5 минут";start()}

function sound(){
  try{
    const c=new(window.AudioContext||window.webkitAudioContext)(),t=c.currentTime;
    [[523,.16],[659,.16]].forEach((z,i)=>{const o=c.createOscillator(),g=c.createGain();o.type="triangle";o.frequency.value=z[0];o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(.12,t+i*.18);g.gain.exponentialRampToValueAtTime(.001,t+i*.18+z[1]);o.start(t+i*.18);o.stop(t+i*.18+z[1]);});
  }catch(_){ }
}
function vib(){try{if("vibrate" in navigator)navigator.vibrate([140,80,140])}catch(_){}}
function askNotif(){if(!("Notification" in window))return;if(IS_IOS&&!IS_STANDALONE){alert("На iPhone сначала добавь приложение на экран Домой.");return}if(Notification.permission==="default")Notification.requestPermission().finally(updNotif);else updNotif()}
function updNotif(){if(!("Notification" in window)){E.notif.textContent="Нет API";E.notif.disabled=true;return}if(IS_IOS&&!IS_STANDALONE){E.notif.textContent="Через Домой";return}if(Notification.permission==="granted")E.notif.textContent="Включено";else if(Notification.permission==="denied")E.notif.textContent="Блок";else E.notif.textContent="Уведомления"}
function notify(body){if("Notification" in window&&Notification.permission==="granted")new Notification("FitPush",{body,tag:"fitpush"})}

function pwa(){if(!("serviceWorker" in navigator))return;const ok=location.protocol==="https:"||location.hostname==="localhost"||location.hostname==="127.0.0.1";if(ok)navigator.serviceWorker.register("./sw.js").catch(()=>{})}

E.presets.addEventListener("click",e=>{const b=e.target.closest("button[data-min]");if(!b)return;pick(Number(b.dataset.min))});
E.start.addEventListener("click",start);
E.pause.addEventListener("click",pause);
E.reset.addEventListener("click",reset);
E.now.addEventListener("click",()=>fire("manual"));
E.notif.addEventListener("click",askNotif);
E.done.addEventListener("click",done);
E.skip.addEventListener("click",skip);
E.snooze.addEventListener("click",snooze);

document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"&&S.run&&S.end){S.left=Math.max(0,Math.round((S.end-Date.now())/1000));if(S.left<=0){if(S.id){clearInterval(S.id);S.id=null}S.run=false;fire("timer")}render()}});
document.addEventListener("keydown",e=>{const k=e.key.toLowerCase();if(k==="s"){if(S.run)pause();else start()}if(k==="r")reset();if(k==="n")fire("manual");if(k==="escape")E.overlay.classList.remove("show")});

load();pick(60);updNotif();render();pwa();
</script>
</body>
</html>
